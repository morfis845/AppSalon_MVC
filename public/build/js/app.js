let step=1;const stepInit=1,stepEnd=3;let day;const meeting={id:"",name:"",date:"",hour:"",services:[]};function initApp(){showSection(),tabs(),pagerButtons(),nextPage(),backPage(),clientId(),clientName(),dateSelected(),hourSelected(),showResume()}function showSection(){const e=document.querySelector(".show");e&&e.classList.remove("show");const t="#step-"+step;document.querySelector(t).classList.add("show");const n=document.querySelector(".current");n&&n.classList.remove("current");document.querySelector(`[data-step="${step}"]`).classList.add("current"),3===step&&showResume()}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){step=parseInt(e.target.dataset.step),showSection(),pagerButtons()}))})}function pagerButtons(){const e=document.querySelector("#next"),t=document.querySelector("#back");1===step?(t.classList.add("hide"),e.classList.remove("hide")):2===step?(t.classList.remove("hide"),e.classList.remove("hide")):3===step&&(t.classList.remove("hide"),e.classList.add("hide"))}function backPage(){document.querySelector("#back").addEventListener("click",(function(){step>1&&(step--,showSection(),pagerButtons())}))}function nextPage(){document.querySelector("#next").addEventListener("click",(function(){step<3&&(step++,showSection(),pagerButtons())}))}async function consultAPI(){try{const e="http://localhost:3000/api/services",t=await fetch(e);showServices(await t.json())}catch(e){console.log(e)}}function showServices(e){e.forEach(e=>{const{id:t,name:n,price:o}=e,c=document.createElement("P");c.classList.add("name-service"),c.textContent=n;const a=document.createElement("P");a.classList.add("price-service"),a.textContent="$"+o;const s=document.createElement("DIV");s.classList.add("service"),s.dataset.idService=t,s.onclick=function(){selecService(e)},s.appendChild(c),s.appendChild(a),document.querySelector("#services").appendChild(s)})}function selecService(e){const{id:t}=e,{services:n}=meeting,o=document.querySelector(`[data-id-service="${t}"]`);n.some(e=>e.id===t)?(meeting.services=n.filter(e=>e.id!==t),o.classList.remove("selected")):(meeting.services=[...n,e],o.classList.add("selected"))}function clientName(){const e=document.querySelector("#name").value;meeting.name=e}function dateSelected(){document.querySelector("#date").addEventListener("input",(function(e){day=new Date(e.target.value).getUTCDay(),[0].includes(day)?(e.target.value="",showAlert("Domingos no trabajamos","error",".form")):(meeting.date=e.target.value,document.querySelector("#hour").disabled=!1,document.querySelector("#hour").value="")}))}function clientId(){meeting.id=document.querySelector("#id").value}function showAlert(e,t,n,o=!0){const c=document.querySelector(".alert");c&&c.remove();const a=document.createElement("DIV");a.textContent=e,a.classList.add("alert"),a.classList.add(t);document.querySelector(n).appendChild(a),o&&setTimeout(()=>{a.remove()},3e3)}function hourSelected(){document.querySelector("#hour").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];day>0&&day<6&&(t<9||t>18?(e.target.value="",showAlert("Nuestro horario de atencion es de 9 am a 6 pm. y Sabados de 9am a 12 del mediodía","error",".form")):meeting.hour=e.target.value),6===day&&(t<9||t>12?(e.target.value="",showAlert("Nuestro horario de atencion es de 9 am a 6 pm. y Sabados de 9am a 12 del mediodía","error",".form")):meeting.hour=e.target.value)}))}function showResume(){const e=document.querySelector(".content-resume");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(meeting).includes("")||0===meeting.services.length)return void showAlert("Faltan datos de servicios, fecha u hora","error",".content-resume",!1);const{name:t,date:n,hour:o,services:c}=meeting,a=document.createElement("H3");a.textContent="Resumen de Servicios",e.appendChild(a),c.forEach(t=>{const{id:n,price:o,name:c}=t,a=document.createElement("DIV");a.classList.add("container-service");const s=document.createElement("P");s.textContent=c;const r=document.createElement("P");r.innerHTML="<span>Precio: </span>$"+o,a.appendChild(s),a.appendChild(r),e.appendChild(a)});const s=document.createElement("P");s.innerHTML="<span>Nombre: </span> "+t;const r=document.createElement("P"),i=new Date(n),d=i.getMonth(),u=i.getDate()+2,l=i.getFullYear(),m=new Date(Date.UTC(l,d,u)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"});r.innerHTML="<span>Fecha: </span> "+m;const p=document.createElement("P");p.innerHTML="<span>Hora: </span> "+o;const h=document.createElement("H3");h.textContent="Resumen de Cita",e.appendChild(h);const v=document.createElement("BUTTON");v.classList.add("button"),v.textContent="Reservar Cita",v.onclick=confirmMeeting,e.appendChild(s),e.appendChild(r),e.appendChild(p),e.appendChild(v)}async function confirmMeeting(){const{name:e,date:t,hour:n,services:o,id:c}=meeting,a=o.map(e=>e.id),s=new FormData;s.append("date",t),s.append("hour",n),s.append("userId",c),s.append("services",a);try{const e="http://localhost:3000/api/meeting",t=await fetch(e,{method:"POST",body:s});(await t.json()).result&&Swal.fire({icon:"success",title:"Cita Creada",text:"Tu cita fue creada correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.reload()},3e3)})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al guardar la cita"})}}document.addEventListener("DOMContentLoaded",(function(){initApp(),consultAPI()}));